# æµ‹è¯•é©±åŠ¨å¼€å‘

åœ¨ä¸Šä¸€ç« é‡Œï¼Œæˆ‘ç”¨ä¸€ä¸ªä¾‹å­ç»™å¤§å®¶è§£é‡Šäº† `getSearchObj` å‡½æ•°çš„å«ä¹‰ï¼š

```ts
window.location.href = 'https://www.baidu.com?a=1&b=2'

const result = getSearchObj()

// result = {
//   a: '1',
//   b: '2',
// }
```

å¦‚æœå¤§å®¶æ²¡æœ‰å†™è¿‡ `getSearchObj`ï¼Œå¯èƒ½ä¼šåœ¨å®ç°çš„æ—¶å€™æ‰“å¾ˆå¤šä¸ª `console.log` æ¥è°ƒè¯•å®ƒï¼š

```ts
const getSearchObj = () => {
  // ?a=1&b=2
  const { search } = window.location;

  const searchStr = search.slice(1);
  console.log('searchStr', searchStr) // a=1&b=2
  
  const pairs = searchStr.split("&"); 
  console.log('pairs', pairs); // ['a=1', 'b=2']

  const searchObj: Record<string, string> = {}; 
  console.log('searchObj', searchObj); // { 'a': '1' }

  pairs.forEach((pair) => {
    
    const [key, value] = pair.split("=");
    console.log('key', key, 'value', value) //  [a, 1]
    searchObj[key] = value;
  });

  return searchObj;
};

console.log('result', getSearchObj());
```

è¿™äº› `log` ä¸ä»…éš¾çœ‹ï¼Œè€Œä¸” `log` å‡ºæ¥åæˆ‘ä»¬è¿˜è¦æŠŠä»–ä»¬åˆ æ‰ï¼Œä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬å¾ˆå¤§å¯èƒ½åªä¼šåˆ°æµ‹ä¸€ä¸¤ç§æƒ…å†µï¼Œä¸èƒ½è¦†ç›–åˆ°æ‰€æœ‰è¾¹ç•Œæ¡ä»¶ã€‚
**å…¶å®ï¼Œè¿™é‡Œçš„ `log` æ“ä½œï¼Œæœ¬è´¨åªæ˜¯æˆ‘ä»¬çš„ä¸€ç§æ‰‹åŠ¨æµ‹è¯•ï¼š`æ‰§è¡Œ -> ç”¨çœ¼ç›çœ‹ç»“æœ`ã€‚** 

æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸æŠŠè¿™æ ·çš„æ“ä½œè‡ªåŠ¨åŒ–å‘¢ï¼Ÿæ¯”å¦‚ï¼šç”¨ç¨‹åºè‡ªåŠ¨æ‰§è¡Œ `getSearchObj` ä»£æ›¿æ‰‹åŠ¨ä¸€ééåˆ·æ–°é¡µé¢ã€ç”¨æ–­è¨€ API ä»£æ›¿è‚‰çœ¼æ‰¾èŒ¬ã€
ç”¨æœºå™¨ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªæµ‹è¯•ç”¨ä¾‹æ¥ä»£æ›¿æ‰‹åŠ¨ä¼ ä¸åŒå‚ï¼Œç­‰ç­‰ã€‚ **è¿™å°±æ˜¯ TDDï¼ˆTest Driven Developmentï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘çš„å¼€å‘æ¨¡å¼ã€‚**

## ç®€è¿° TDD

TDD æ˜¯ä¸€ç§éå¸¸å¥½ç”¨çš„å¼€å‘æ¨¡å¼ï¼Œåšæ³•å¾ˆç®€å•ï¼š**å…ˆå†™æµ‹è¯•ï¼Œå†å†™ä¸šåŠ¡ä»£ç ï¼Œå½“æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½é€šè¿‡åï¼Œä½ çš„ä¸šåŠ¡ä»£ç ä¹Ÿå°±å®ç°å®Œäº†**ï¼Œå›¾è§£ï¼š

![](./cycle.jpg)

* ğŸš¨ çº¢è‰²éƒ¨åˆ†ï¼šåœ¨ä½ è¿˜æ²¡æ·»åŠ æ–°åŠŸèƒ½å‰å…ˆå†™çš„ä¸€ä¸ªæµ‹è¯•ã€‚ç„¶åä½ ä¼šå¾—åˆ°ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ï¼ˆçœ‹åˆ° â€œçº¢è‰²â€ çš„æŠ¥é”™ä¿¡æ¯ï¼‰ã€‚
* âœ… ç»¿è‰²éƒ¨åˆ†ï¼šä¸æ–­æ·»åŠ ä¸šåŠ¡ä»£ç æ¥è®©æµ‹è¯•é€šè¿‡ï¼ˆçœ‹åˆ° â€œç»¿è‰²â€ æˆåŠŸé€šè¿‡ä¿¡æ¯ï¼‰ã€‚
* ğŸŒ€ é‡æ„éƒ¨åˆ†ï¼šå†å›è¿‡å¤´çœ‹å®¡è§†è‡ªå·±çš„ä»£ç ï¼ŒæŠŠå®ƒé‡æ„æˆå¯è¯»æ€§å’Œç»´æŠ¤æ€§æ›´é«˜çš„ä»£ç ï¼ˆè¿™ä¸€æ­¥æœ€çˆ½çš„ç‚¹å°±æ˜¯åœ¨é‡æ„æ—¶ï¼Œä½ æœ‰ä¸€ä¸ªæµ‹è¯•ä¼šå‘Šè¯‰ä½ æœ‰æ²¡æœ‰æå´©åŸæœ‰é€»è¾‘ï¼‰ã€‚
* ğŸ” é‡å¤ï¼šè¿™å°±æ˜¯ä¸ªå¾ªç¯ï¼Œåæ­£ ğŸ˜‰ ä¸€ç›´èµ°ä¸‹å»ï¼Œç›´åˆ°å†™å®Œè¿™ä¸ªåŠŸèƒ½

**ä¸ä¹‹ç›¸åçš„å°±æ˜¯ BDDï¼ˆBehavior Driven Developmentï¼‰è¡Œä¸ºé©±åŠ¨æµ‹è¯•ï¼Œä¹Ÿå³åœ¨å®ç°æ‰€æœ‰ä¸šåŠ¡åï¼Œæˆ‘ä»¬å†å¯¹ä¸€äº›é‡è¦éƒ¨åˆ†æ¥è¡¥æµ‹è¯•ç”¨ä¾‹ã€‚**
æˆ‘ä»¬ä¹‹å‰å†™çš„ `sum`, `storage` ä»¥åŠ `getSearchObj` éƒ½è¿™ç§å¼€å‘æ¨¡å¼ã€‚

å¤§éƒ¨åˆ†äººä¸å¤ªèƒ½æ¥å—å…ˆå†™æµ‹è¯•å†å†™ä¸šåŠ¡è¿™ç§æ¨¡å¼ï¼Œè§‰å¾—å…ˆèŠ±é‚£ä¹ˆå¤šæ—¶å€™åœ¨æµ‹è¯•ä¸Šä¸å€¼å¾—ã€‚è¿™å…¶å®æ˜¯å¾ˆå¤šäººçš„ä¸€ç§è¯¯è§£ï¼Œä»–ä»¬å¹¶æ²¡æœ‰ææ¸…æ¥š TDD è¦è§£å†³çš„é—®é¢˜ä»¥åŠå®ƒçš„é€‚ç”¨åœºæ™¯ã€‚
TDD æœ‰ä»¥ä¸‹é€‚ç”¨åœºæ™¯ï¼š

**ç¬¬ä¸€ç§ï¼šå†™çº¯å‡½æ•°åœºæ™¯ã€‚** åƒæˆ‘ä»¬å†™çš„ `sum` å’Œ `getSearchObj` å°±æ˜¯çº¯å‡½æ•°ã€‚ä¸ç®¡é‡Œé¢çš„é€»è¾‘ç®€å•è¿˜æ˜¯å¤æ‚ï¼Œæˆ‘ä»¬éƒ½å¾ˆå®¹æ˜“å°±èƒ½æƒ³åˆ°è¿™äº›å‡½æ•°çš„è¾“å…¥è¾“å‡ºï¼Œ
æ‰€ä»¥å†™è¿™äº›å‡½æ•°çš„æµ‹è¯•ç”¨ä¾‹æ˜¯å¾ˆç®€å•çš„ã€‚åœ¨å†™ä¸šåŠ¡å‰å…ˆå®šä¹‰å¥½ 90% ä½¿ç”¨åœºæ™¯çš„è¾“å…¥è¾“å‡ºï¼Œ`jest` å°±èƒ½å¿«é€Ÿå¸®æˆ‘ä»¬éªŒè¯ä¸šåŠ¡å®ç°æ˜¯å¦æ­£ç¡®ï¼Œè€Œä¸ç”¨é¢‘ç¹åœ° `log`ã€‚

**ç¬¬äºŒç§ï¼šä¿® Bug åœºæ™¯ã€‚** è¿™å¯¹æ²¡æœ‰ä»»ä½•æµ‹è¯•çš„é¡¹ç›®éå¸¸å®ç”¨ï¼Œå½“é‡åˆ° Bug æ—¶ï¼Œå¯ä»¥å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥å¤ç°é—®é¢˜ï¼Œç„¶åé€šè¿‡è¿™ä¸ªç”¨ä¾‹æ¥è°ƒè¯•ä¸šåŠ¡ä»£ç ï¼Œå½“ç”¨ä¾‹é€šè¿‡åï¼Œ
ä¸šåŠ¡ä»£ç ä¹Ÿè‡ªç„¶è¢«ä¿®å¤äº†ã€‚

**ç¬¬ä¸‰ç§ï¼šUI äº¤äº’åœºæ™¯ã€‚** åœ¨å¼€å§‹å†™é¡µé¢é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ HTTP è¯·æ±‚ç»™ Mock æ‰ï¼ˆåœ¨åé¢ä¼šè®²åˆ°ï¼‰ï¼Œå…ˆç”¨æµ‹è¯•æ¨¡æ‹ŸçœŸå®ç”¨æˆ·çš„ä½¿ç”¨è·¯å¾„ï¼Œç„¶åå†å®ç°ä¸šåŠ¡é€»è¾‘ã€‚
å½“æµ‹è¯•ç”¨ä¾‹é€šè¿‡åï¼Œè¯´æ˜éœ€æ±‚ä¸»æµç¨‹ä¹Ÿæ˜¯èƒ½èµ°é€šçš„ã€‚

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢è¿™äº›åœºæ™¯å¹¶æ²¡æœ‰è¯´åˆ° "ä»£ç è´¨é‡"ï¼Œ"è¦†ç›–ç‡"ï¼Œ"å¼‚å¸¸æƒ…å†µ"ï¼Œ**æ‰€ä»¥ï¼ŒTDD çš„ä½œç”¨å¹¶ä¸æ˜¯ç›´æ¥ä¿è¯ä»£ç è´¨é‡ï¼Œ
è€Œæ˜¯ç»™å¼€å‘è€…åˆ›é€ ä¸€ä¸ªæ›´èˆ’é€‚çš„å¼€å‘ç¯å¢ƒï¼ŒåŒæ—¶ä¿éšœäº†ä»£ç ä½¿ç”¨çš„ä¸»æµç¨‹ã€‚**

æˆ‘ä»¬è¿˜å¯èƒ½æ€»ç»“å‡º **TDD çš„ä½¿ç”¨åœºæ™¯æ˜¯é‚£äº›å®ç°æ¯”è¾ƒå¤æ‚ï¼Œä½†è¾“å…¥è¾“å‡ºå¾ˆæ˜ç¡®çš„åœºæ™¯ã€‚** æ‰€ä»¥ TDD æ›´å¤šä¼šè¢«ç”¨åˆ°å‰ç«¯çš„é¡µé¢ E2E æµ‹è¯•ï¼Œå·¥å…·å‡½æ•°æµ‹è¯•ï¼Œæ•°æ®è½¬æ¢å‡½æ•°æµ‹è¯•ï¼Œ
ä»¥åŠåç«¯çš„æ¥å£å’ŒæœåŠ¡æµ‹è¯•ã€‚

## ç”¨ä¾‹æ–‡æ¡£åŒ–

**TDD çš„å¦ä¸€ä¸ªå¥½å¤„ï¼ˆåº”è¯¥è¯´æ˜¯æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹çš„å¥½å¤„ï¼‰å°±æ˜¯ç”¨ä¾‹æ–‡æ¡£åŒ–ã€‚**

è¿˜è®°å¾—ä¸Šä¸€ç« æˆ‘æ˜¯æ€ä¹ˆç»™å¤§å®¶è¯´æ¸…æ¥š `getSearchObj` çš„å«ä¹‰å’Œä½œç”¨ä¹ˆï¼Ÿæˆ‘å«Œå•°å—¦ï¼Œç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è®©ä½ æ˜ç™½ä»€ä¹ˆå« "æŠŠç½‘é¡µåœ°å€ä¸­çš„æŸ¥è¯¢å‚æ•°è½¬æ¢ä¸º `Object` ç±»å‹"ï¼š

```ts
window.location.href = 'https://www.baidu.com?a=1&b=2'

const result = getSearchObj()

// result = {
//   a: '1',
//   b: '2',
// }
```

å¦‚æœè¿™æ—¶åˆæœ‰ä¸€ä¸ªäººé—®æˆ‘è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥å¹²å˜›çš„ï¼Œæˆ‘å¯èƒ½åˆè¦ä¸¾ä¸€éè¿™ä¸ªä¾‹å­ã€‚é‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸æŠŠå®ƒè®°å½•åˆ°ä»£ç é‡Œå‘¢ï¼Ÿ**å½“æˆ‘ä»¬åœ¨åš TDD æ—¶ï¼Œ
æå‰å†™çš„è¿™äº›æµ‹è¯•ç”¨ä¾‹éƒ½å°†ä¼šå­˜åˆ°ä»£ç ä»“åº“é‡Œï¼Œè¿™å°±æ˜¯ç”¨ä¾‹æ–‡æ¡£åŒ–ã€‚** å®ƒçš„å¥½å¤„æœ‰ï¼š

**é™ä½ä¸Šæ‰‹éš¾åº¦ã€‚** ç›¸ä¿¡å¤§å®¶åšä¸šåŠ¡æ—¶ç»å¸¸å¬åˆ°å¦å¤–å°ä¼™ä¼´è¯´ï¼š"ä½ çœ‹ XXX æ–‡ä»¶å°±çŸ¥é“è¿™ä¸ªæ€ä¹ˆç”¨äº†"ã€‚ä½†è¿™ä¸ª XXX æ–‡ä»¶å¾€å¾€æœ‰éå¸¸å¤šçš„ä¾èµ–é¡¹å’Œå¹²æ‰°é¡¹ï¼Œ
ä½ æ ¹æœ¬ä¸çŸ¥é“æœ€ç®€å•ï¼Œæœ€åŸå§‹çš„ä½¿ç”¨æ–¹æ³•ã€‚è€Œæµ‹è¯•ï¼Œç‰¹åˆ«æ˜¯å•æµ‹å¾€å¾€åªæµ‹å…¶ä¸­ä¸€ä¸ªä½¿ç”¨åœºæ™¯ï¼Œæ‰€ä»¥æµ‹è¯•ç”¨ä¾‹å¾€å¾€è®°å½•ç€æœ€ç®€å•ã€æœ€æœ´ç´ çš„ä½¿ç”¨æ–¹æ³•ã€‚

**ç”¨ä¾‹æ­£ç¡®æ€§ã€‚** æ¥å£æ–‡æ¡£åŒ–æ˜¯åšåç«¯ï¼ˆNode ç«¯ï¼‰éå¸¸é‡è¦çš„ä¸€æ­¥ï¼Œæœ‰çš„äººå†™åœ¨è…¾è®¯æ–‡æ¡£ï¼Œæœ‰çš„äººå–œæ¬¢å­˜åœ¨ Postman é‡Œæ–¹ä¾¿æµ‹è¯•ã€‚ä½†è¿™äº›ç”¨ä¾‹æœ‰ä¸ªè‡´å‘½çš„ç¼ºç‚¹ï¼š
åœ¨æ¥å£å‘ç”Ÿå˜æ›´æ—¶ï¼Œä¸ä¸€å®šèƒ½åŠæ—¶æ›´æ–°æ–‡æ¡£å¯¹åº”çš„ç¤ºä¾‹ã€‚è€Œæµ‹è¯•ç”¨ä¾‹æ­£å¥½å¯ä»¥åº”å¯¹è¿™æ ·çš„æƒ…å†µï¼Œç”±äºæµ‹è¯•ç”¨ä¾‹å¿…é¡»éƒ½é€šè¿‡æ‰èƒ½ Push ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒè¿™äº›ç”¨ä¾‹çš„è¿‡æœŸé—®é¢˜ã€‚

## ä½¿ç”¨ TDD

è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»¬æ¥ç®€å•ä½¿ç”¨ä¸€ä¸‹ TDDã€‚å‡å¦‚ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼š*æŠŠç»™å®šå¯¹è±¡è½¬æ¢æˆæŸ¥è¯¢å‚æ•°å­—ç¬¦ä¸²ã€‚*

é¦–å…ˆï¼Œæˆ‘ä»¬æ·»åŠ  `tests/utils/objToSearchStr.test.ts`ï¼Œç”¨æµ‹è¯•ç”¨ä¾‹æ¥æè¿°è¿™ä¸ªéœ€æ±‚ï¼š

```ts
import objToSearchStr from "utils/objToSearchStr";

describe("objToSearchStr", () => {
  it("å¯ä»¥å°†å¯¹è±¡è½¬åŒ–æˆæŸ¥è¯¢å‚æ•°å­—ç¬¦ä¸²", () => {
    expect(
      objToSearchStr({
        a: "1",
        b: "2",
      })
    ).toEqual("a=1&b=2");
  });
});
```

ç°åœ¨å†æ·»åŠ  `src/utils/objToSearchStr.ts`ï¼Œè¾¹çœ‹ä¸šåŠ¡è¾“å…¥è¾“å‡ºè¾¹å®ç°ä»£ç é€»è¾‘ï¼š

```ts
const objToSearchStr = (obj: Record<string, string | number>) => {
  // ['a=1', 'b=2']
  const strPairs: string[] = [];

  Object.entries(obj).forEach((keyValue) => {
    const [key, value] = keyValue; // [a, 1]
    const pair = key + "=" + String(value); // a=1
    strPairs.push(pair);
  }, []);

  // a=1&b=2
  return strPairs.join("&");
};

export default objToSearchStr;
```

è¿™æ ·å»å¼€å‘æ˜¯ä¸æ˜¯æ¯”ç–¯ç‹‚æ‰“ `log` æ¥å¾—æ›´é«˜æ•ˆå‘¢ï¼Ÿè€Œä¸”æˆ‘ä»¬è¿˜èƒ½åˆ©ç”¨ IDE çš„è°ƒè¯•å™¨æ¥åšæ–­ç‚¹è°ƒè¯•ã€‚

## æ€»ç»“

åœ¨è¿™ä¸€ç« é‡Œï¼Œæˆ‘ä»¬äº†è§£åˆ° TDD å’Œ BDD ä¸¤ç§å¼€å‘æ¨¡å¼ã€TDD çš„ä½¿ç”¨åœºæ™¯å’Œè¦è§£å†³çš„é—®é¢˜ã€ä»¥åŠç”¨ä¾‹æ–‡æ¡£åŒ–çš„å¥½å¤„ã€‚
æœ€åï¼Œæˆ‘ä»¬ç”¨ TDD çš„å¼€å‘æ¨¡å¼æ¥å®ç°äº† `objToSearchStr` è¿™ä¸ªå‡½æ•°ã€‚
