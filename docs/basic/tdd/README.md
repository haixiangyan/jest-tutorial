# æµ‹è¯•é©±åŠ¨å¼€å‘

åœ¨ä¸Šä¸€ç« ï¼Œæˆ‘ç”¨ä¸€ä¸ªä¾‹å­ç»™å¤§å®¶è§£é‡Šäº† `getSearchObj` å‡½æ•°çš„ä½œç”¨ï¼š

```ts
window.location.href = 'https://www.baidu.com?a=1&b=2'

const result = getSearchObj()

// result = {
//   a: '1',
//   b: '2',
// }
```

å¦‚æœå¤§å®¶æ²¡æœ‰å†™è¿‡ `getSearchObj`ï¼Œå¯èƒ½ä¼šåœ¨å®ç°çš„æ—¶å€™æ‰“å¾ˆå¤šä¸ª `console.log` æ¥è°ƒè¯•å®ƒï¼š

```ts
const getSearchObj = () => {
  // ?a=1&b=2
  const { search } = window.location;

  const searchStr = search.slice(1);
  console.log('searchStr', searchStr) // a=1&b=2
  
  const pairs = searchStr.split("&"); 
  console.log('pairs', pairs); // ['a=1', 'b=2']

  const searchObj: Record<string, string> = {}; 
  console.log('searchObj', searchObj); // { 'a': '1' }

  pairs.forEach((pair) => {
    
    const [key, value] = pair.split("=");
    console.log('key', key, 'value', value) //  [a, 1]
    searchObj[key] = value;
  });

  return searchObj;
};

console.log('result', getSearchObj());
```

è¿™äº› `log` ä¸ä»…éš¾çœ‹ï¼Œè€Œä¸” `log` å‡ºæ¥åæˆ‘ä»¬è¿˜è¦æŠŠä»–ä»¬åˆ æ‰ã€‚è€Œä¸”ï¼Œè¿™æ ·æœ€å¤šåªèƒ½æµ‹åˆ°ä¸€ä¸¤ç§ Caseï¼Œä¸èƒ½è¦†ç›–åˆ°æ‰€æœ‰è¾¹ç•Œæƒ…å†µã€‚ä¸ºäº†èƒ½æ‰‹åŠ¨æ‰§è¡Œå®ƒï¼Œ
æˆ‘ä»¬è¿˜å¾—ä¸€ééåˆ·æ–°ç½‘é¡µï¼Œç„¶åè‚‰çœ¼æ‰¾èŒ¬ã€‚

::: tip
**è¿™é‡Œçš„ `log` æ“ä½œï¼Œä¹Ÿå¯ä»¥çœ‹æˆæ˜¯ä¸€ç§æ‰‹åŠ¨æµ‹è¯•ï¼š`æ‰§è¡Œ -> ç”¨çœ¼ç›çœ‹ç»“æœ`ã€‚** 
:::

é‚£ä¸ºä»€ä¹ˆä¸æŠŠä¸Šè¿™äº›æ“ä½œè‡ªåŠ¨åŒ–ï¼Œç”¨ç¨‹åºä»£æ›¿æ‰‹å·¥å‘¢ï¼Ÿ**è¿™å°±æ˜¯ TDDï¼ˆTest Driven Developmentï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘ã€‚**

## åŸç†

TDD æ˜¯ä¸€ç§éå¸¸å¥½ç”¨çš„å¼€å‘æ¨¡å¼ï¼Œåšæ³•å¾ˆç®€å•ï¼š**å…ˆå†™æµ‹è¯•ï¼Œå†å†™ä¸šåŠ¡ä»£ç ï¼Œå½“æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½é€šè¿‡åï¼Œä½ çš„ä¸šåŠ¡ä»£ç ä¹Ÿå°±å®ç°å®Œäº†**ï¼Œå›¾è§£ï¼š

![](./cycle.jpg)

* ğŸš¨ çº¢è‰²éƒ¨åˆ†ï¼šåœ¨ä½ è¿˜æ²¡æ·»åŠ æ–°åŠŸèƒ½å‰å…ˆå†™çš„ä¸€ä¸ªæµ‹è¯•ã€‚ç„¶åä½ ä¼šå¾—åˆ°ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ï¼ˆçœ‹åˆ° â€œçº¢è‰²â€ çš„æŠ¥é”™ä¿¡æ¯ï¼‰ã€‚
* âœ… ç»¿è‰²éƒ¨åˆ†ï¼šä¸æ–­æ·»åŠ ä¸šåŠ¡ä»£ç æ¥è®©æµ‹è¯•é€šè¿‡ï¼ˆçœ‹åˆ° â€œç»¿è‰²â€ æˆåŠŸé€šè¿‡ä¿¡æ¯ï¼‰ã€‚
* ğŸŒ€ é‡æ„éƒ¨åˆ†ï¼šå†å›è¿‡å¤´çœ‹å®¡è§†è‡ªå·±çš„ä»£ç ï¼ŒæŠŠå®ƒé‡æ„æˆå¯è¯»æ€§å’Œç»´æŠ¤æ€§æ›´é«˜çš„ä»£ç ï¼ˆè¿™ä¸€æ­¥æœ€çˆ½çš„ç‚¹å°±æ˜¯åœ¨é‡æ„æ—¶ï¼Œä½ æœ‰ä¸€ä¸ªæµ‹è¯•ä¼šå‘Šè¯‰ä½ æœ‰æ²¡æœ‰æå´©åŸæœ‰é€»è¾‘ï¼‰ã€‚
* ğŸ” é‡å¤ï¼šè¿™å°±æ˜¯ä¸ªå¾ªç¯ï¼Œåæ­£ ğŸ˜‰ ä¸€ç›´èµ°ä¸‹å»ï¼Œç›´åˆ°å†™å®Œè¿™ä¸ªåŠŸèƒ½

**TDD ç«™åœ¨å¼€å‘è€…çš„è§†è§’æµ‹è¯•ä¸€ä¸ªåŠŸèƒ½çš„ç»„æˆæ¨¡å—æ¯”å¦‚å‡½æ•°æˆ–æ–¹æ³•æ˜¯å¦é¢„æœŸï¼Œè€Œ BDDï¼ˆBehavior Driven Developmentï¼‰è¡Œä¸ºé©±åŠ¨æµ‹è¯•ï¼Œä¸ä¹‹ä¸åŒæ˜¯ç«™åœ¨ç”¨æˆ·çš„è§’åº¦æè¿°æµ‹è¯•ç”¨ä¾‹ã€‚æ›´å¤šå¯é˜…è¯» [Understanding the Differences Between BDD & TDD](https://cucumber.io/blog/bdd/bdd-vs-tdd/#:~:text=BDD%20is%20designed%20to%20test,pieces%20of%20functionality%20in%20isolation.)ã€‚**

æˆ‘ä»¬ä¹‹å‰å†™çš„ `sum`, `storage` ä»¥åŠ `getSearchObj` å±äº TDD å¼€å‘æ¨¡å¼ã€‚

## é€‚ç”¨åœºæ™¯

æˆ–è®¸æœ‰äº›äººä¸å¤ªèƒ½æ¥å—å…ˆå†™æµ‹è¯•å†å†™ä¸šåŠ¡è¿™ç§æ¨¡å¼ï¼Œè§‰å¾—å…ˆèŠ±é‚£ä¹ˆå¤šæ—¶å€™åœ¨æµ‹è¯•ä¸Šä¸å€¼å¾—ã€‚è¿™å…¶å®æ˜¯ä¸€ç§è¯¯è§£ï¼Œä»–ä»¬å¹¶æ²¡æœ‰ææ¸…æ¥š TDD è¦è§£å†³çš„é—®é¢˜ä»¥åŠå®ƒçš„é€‚ç”¨åœºæ™¯ã€‚
TDD æœ‰ä»¥ä¸‹é€‚ç”¨åœºæ™¯ï¼š

**ç¬¬ä¸€ç§ï¼šå†™çº¯å‡½æ•°åœºæ™¯ã€‚** å‰é¢å‡ ç« å†™çš„ `sum` å’Œ `getSearchObj` å°±æ˜¯çº¯å‡½æ•°ã€‚ä¸ç®¡é‡Œé¢çš„é€»è¾‘ç®€å•è¿˜æ˜¯å¤æ‚ï¼Œæˆ‘ä»¬éƒ½å¾ˆå®¹æ˜“å°±èƒ½æƒ³åˆ°è¿™äº›å‡½æ•°çš„è¾“å…¥è¾“å‡ºï¼Œ
æ‰€ä»¥å†™è¿™äº›å‡½æ•°çš„æµ‹è¯•ç”¨ä¾‹æ˜¯æœ€ç®€å•çš„ã€‚å…ˆåœ¨å†™ä¸šåŠ¡å‰å…ˆå®šä¹‰å¥½ 90% ä½¿ç”¨åœºæ™¯çš„è¾“å…¥è¾“å‡ºï¼ŒJest å°±èƒ½å¿«é€Ÿå¸®æˆ‘ä»¬éªŒè¯ä¸šåŠ¡å®ç°æ˜¯å¦æ­£ç¡®ï¼Œè€Œä¸ç”¨é¢‘ç¹åœ° `console.log`ã€‚

**ç¬¬äºŒç§ï¼šä¿® Bug åœºæ™¯ã€‚** è¿™å¯¹æ²¡æœ‰ä»»ä½•æµ‹è¯•çš„é¡¹ç›®éå¸¸å®ç”¨ã€‚å½“é‡åˆ° Bug æ—¶ï¼Œå…ˆå†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥å¤ç°é—®é¢˜ï¼Œç„¶åé€šè¿‡è¿™ä¸ªç”¨ä¾‹æ¥è°ƒè¯•ä¸šåŠ¡ä»£ç ã€‚ç”¨ä¾‹é€šè¿‡åï¼Œ
ä¸šåŠ¡ä»£ç ä¹Ÿè‡ªç„¶è¢«ä¿®å¤äº†ã€‚

**ç¬¬ä¸‰ç§ï¼šUI äº¤äº’åœºæ™¯ã€‚** åœ¨å¼€å§‹å†™é¡µé¢é€»è¾‘æ—¶ï¼ŒæŠŠ HTTP è¯·æ±‚ç»™ Mock æ‰ï¼ˆåœ¨åé¢ä¼šè®²åˆ°ï¼‰ï¼Œå…ˆç”¨æµ‹è¯•æ¨¡æ‹ŸçœŸå®ç”¨æˆ·çš„ä½¿ç”¨è·¯å¾„ï¼Œç„¶åå†å®ç°ä¸šåŠ¡é€»è¾‘ã€‚
å½“æµ‹è¯•ç”¨ä¾‹é€šè¿‡åï¼Œè¯´æ˜éœ€æ±‚çš„ä¸»é€»è¾‘ä¹Ÿæ˜¯èƒ½èµ°é€šçš„ã€‚

å¯ä»¥çœ‹åˆ°ä¸Šé¢è¿™äº›åœºæ™¯ä¸­æ²¡æœ‰è¯´åˆ° â€œä»£ç è´¨é‡â€ï¼Œâ€œè¦†ç›–ç‡â€ï¼Œâ€œå¼‚å¸¸æƒ…å†µâ€ï¼Œ**æ‰€ä»¥ï¼ŒTDD çš„ä¸»è¦ä½œç”¨ä¸æ˜¯ä¿è¯ä»£ç è´¨é‡ï¼Œ
è€Œæ˜¯ç»™å¼€å‘è€…åˆ›é€ ä¸€ä¸ªæ›´å‹å¥½çš„å¼€å‘ç¯å¢ƒï¼Œåœ¨è¿™åŸºç¡€ä¸Šä¿éšœäº†ä»£ç çš„ä¸»é€»è¾‘ã€‚**

ä»ä¸Šé¢åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š**TDD æ¯”è¾ƒé€‚åˆé‚£äº›å®ç°å¤æ‚ï¼Œä½†è¾“å…¥è¾“å‡ºå¾ˆæ˜ç¡®çš„åœºæ™¯ã€‚** å› æ­¤ï¼ŒTDD ä¹Ÿè¢«å¹¿æ³›ç”¨åˆ°å·¥å…·å‡½æ•°ï¼Œæ•°æ®è½¬æ¢å‡½æ•°ï¼Œ
ä»¥åŠåç«¯çš„æ¥å£æµ‹è¯•ã€‚

## ç”¨ä¾‹æ–‡æ¡£åŒ–

**TDD çš„å¦ä¸€ä¸ªå¥½å¤„ï¼ˆåº”è¯¥è¯´æ˜¯æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹çš„å¥½å¤„ï¼‰å°±æ˜¯ç”¨ä¾‹æ–‡æ¡£åŒ–ã€‚**

è¿˜è®°å¾—ä¸Šä¸€ç« æˆ‘æ˜¯æ€ä¹ˆç»™å¤§å®¶è¯´æ¸…æ¥š `getSearchObj` çš„å«ä¹‰å’Œä½œç”¨ä¹ˆï¼Ÿæˆ‘å«Œå•°å—¦ï¼Œç›´æ¥å¥—ç”¨äº†ä¸€ä¸ªä¾‹å­æ¥è®©ä½ æ˜ç™½ä»€ä¹ˆå« **â€œæŠŠç½‘é¡µåœ°å€ä¸­çš„æŸ¥è¯¢å‚æ•°å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡â€**ï¼š

```ts
window.location.href = 'https://www.baidu.com?a=1&b=2'

const result = getSearchObj()

// result = {
//   a: '1',
//   b: '2',
// }
```

å¦‚æœè¿™æ—¶åˆæœ‰ä¸€ä¸ªäººé—®æˆ‘è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥å¹²å˜›çš„ï¼Œæˆ‘åˆå¾—è¯´ä¸€éè¿™ä¸ªä¾‹å­ã€‚é‚£ä¸ºä»€ä¹ˆä¸æŠŠå®ƒè®°å½•åˆ°ä»£ç é‡Œå‘¢ï¼Ÿ**å½“ä½¿ç”¨ TDD æ—¶ï¼Œ
æå‰å†™çš„æµ‹è¯•ç”¨ä¾‹éƒ½ä¼šæäº¤åˆ°ä»£ç ä»“åº“é‡Œï¼Œå¯ä»¥ä½œä¸ºä¸€ä»½ç®€å•çš„ä½¿ç”¨æ–‡æ¡£ã€‚** è¿™æ ·çš„å¥½å¤„æœ‰ï¼š

**é™ä½ä¸Šæ‰‹éš¾åº¦ã€‚** ç›¸ä¿¡å¤§å®¶åœ¨ä½¿ç”¨åˆ«äººçš„æ¨¡å—æ—¶ï¼Œç»å¸¸ä¼šå¬åˆ°ï¼šâ€œä½ çœ‹ XXX æ–‡ä»¶å°±çŸ¥é“ YYY æ€ä¹ˆç”¨äº†â€ã€‚ä½†è¿™ä¸ª XXX æ–‡ä»¶å¾€å¾€æœ‰éå¸¸å¤šçš„ä¾èµ–å’Œå¹²æ‰°é¡¹ï¼Œ
å¾ˆéš¾å¼„æ¸…æ¥šæœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•ã€‚**è€Œæµ‹è¯•ç”¨ä¾‹ï¼ˆç‰¹åˆ«æ˜¯å•æµ‹ï¼‰é€šå¸¸åªæµ‹å…¶ä¸­ä¸€ä¸ªä½¿ç”¨åœºæ™¯ï¼Œæ‰€ä»¥å®ƒä»¬ä¼šè®°å½•ç€æœ€ç®€å•ã€æœ´ç´ çš„ Use Caseã€‚ä½¿ç”¨è€…åªéœ€çœ‹æµ‹è¯•ç”¨ä¾‹ï¼Œ
å³å¯çŸ¥é“å¦‚ä½•ä¸Šæ‰‹ã€‚**

**ç”¨ä¾‹æ­£ç¡®æ€§ã€‚** æ¥å£æ–‡æ¡£åŒ–æ˜¯åšåç«¯ï¼ˆNode ç«¯ï¼‰éå¸¸é‡è¦çš„ä¸€æ­¥ï¼Œæœ‰çš„äººå†™åœ¨è…¾è®¯æ–‡æ¡£ï¼Œæœ‰çš„äººå–œæ¬¢å­˜åœ¨ Postmanï¼Œä»¥æ–¹ä¾¿è°ƒè¯•ã€‚ä½†è¿™äº›ç”¨ä¾‹æœ‰ä¸ªè‡´å‘½çš„ç¼ºç‚¹ï¼š
æ¥å£å‘ç”Ÿå˜æ›´æ—¶ï¼Œå¾ˆéš¾åŠæ—¶æ›´æ–°å¯¹åº”çš„ç¤ºä¾‹ã€‚æµ‹è¯•ç”¨ä¾‹æ­£å¥½å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ**ç”±äºæµ‹è¯•ç”¨ä¾‹å¿…é¡»å…¨éƒ¨é€šè¿‡æ‰èƒ½ Push ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬æ°¸è¿œä¸ç”¨æ‹…å¿ƒç”¨ä¾‹çš„è¿‡æœŸé—®é¢˜ã€‚**

## å®æˆ˜

è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»¬æ¥ç®€å•ä½¿ç”¨ä¸€ä¸‹ TDDã€‚å‡å¦‚ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼š*æŠŠç»™å®šå¯¹è±¡è½¬æ¢æˆæŸ¥è¯¢å‚æ•°å­—ç¬¦ä¸²ã€‚*

é¦–å…ˆï¼Œæˆ‘ä»¬æ·»åŠ  `tests/utils/objToSearchStr.test.ts`ï¼Œç”¨æµ‹è¯•ç”¨ä¾‹æ¥æè¿°è¿™ä¸ªéœ€æ±‚ï¼š

```ts
import objToSearchStr from "utils/objToSearchStr";

describe("objToSearchStr", () => {
  it("å¯ä»¥å°†å¯¹è±¡è½¬åŒ–æˆæŸ¥è¯¢å‚æ•°å­—ç¬¦ä¸²", () => {
    expect(
      objToSearchStr({
        a: "1",
        b: "2",
      })
    ).toEqual("a=1&b=2");
  });
});
```

ç„¶åï¼Œå†æ¥æ·»åŠ  `src/utils/objToSearchStr.ts`ï¼Œè¾¹çœ‹ä¸šåŠ¡è¾“å…¥è¾“å‡ºè¾¹å®ç°ä»£ç é€»è¾‘ï¼š

```ts
const objToSearchStr = (obj: Record<string, string | number>) => {
  // ['a=1', 'b=2']
  const strPairs: string[] = [];

  Object.entries(obj).forEach((keyValue) => {
    const [key, value] = keyValue; // [a, 1]
    const pair = key + "=" + String(value); // a=1
    strPairs.push(pair);
  }, []);

  // a=1&b=2
  return strPairs.join("&");
};

export default objToSearchStr;
```

åœ¨æ‰§è¡Œæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬è¿˜èƒ½ç”¨ IDE çš„è°ƒè¯•å™¨æ¥åšæ–­ç‚¹è°ƒè¯•ï¼Œç»å¯¹æ¯”ç–¯ç‹‚æ‰“ `console.log` æ¥å¾—é«˜æ•ˆã€‚

## æ€»ç»“

åœ¨è¿™ä¸€ç« é‡Œï¼Œæˆ‘ä»¬å­¦åˆ° TDD å’Œ BDD ä¸¤ç§å¼€å‘æ¨¡å¼ï¼š
* TDDï¼šå…ˆæµ‹è¯•ï¼Œä¹‹åè¡¥å……ä¸šåŠ¡
* BDDï¼šå…ˆå†™ä¸šåŠ¡ï¼Œå†å¯¹é‡è¦éƒ¨åˆ†è¡¥å……æµ‹è¯•

æˆ‘ä»¬è¿˜äº†è§£åˆ°TDD çš„ä½¿ç”¨åœºæ™¯å’Œè¦è§£å†³çš„é—®é¢˜ã€ä»¥åŠç”¨ä¾‹æ–‡æ¡£åŒ–çš„å¥½å¤„ã€‚æœ€åï¼Œæˆ‘ä»¬ç”¨ TDD çš„å¼€å‘æ¨¡å¼æ¥å®ç°äº† `objToSearchStr` è¿™ä¸ªå‡½æ•°ã€‚
