<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jest 性能优化 | Jest 实践指南</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="从基础实战到测试思维，带你全面了解和掌握前端测试">
    <meta name="keywords" content="jest, testing, typescript, eslint, 前端, 测试">
    <meta name="author" content="海怪">
    
    <link rel="preload" href="/jest-tutorial/assets/css/0.styles.3af8d58b.css" as="style"><link rel="preload" href="/jest-tutorial/assets/js/app.dfa51a05.js" as="script"><link rel="preload" href="/jest-tutorial/assets/js/2.03a6ea53.js" as="script"><link rel="preload" href="/jest-tutorial/assets/js/3.9fccf44d.js" as="script"><link rel="prefetch" href="/jest-tutorial/assets/js/10.a5fde7bb.js"><link rel="prefetch" href="/jest-tutorial/assets/js/11.0e357828.js"><link rel="prefetch" href="/jest-tutorial/assets/js/12.d675dd1f.js"><link rel="prefetch" href="/jest-tutorial/assets/js/13.ff10ad5b.js"><link rel="prefetch" href="/jest-tutorial/assets/js/14.1903c055.js"><link rel="prefetch" href="/jest-tutorial/assets/js/15.b6d0931c.js"><link rel="prefetch" href="/jest-tutorial/assets/js/16.6a29a918.js"><link rel="prefetch" href="/jest-tutorial/assets/js/17.d31ffd05.js"><link rel="prefetch" href="/jest-tutorial/assets/js/18.8509fe90.js"><link rel="prefetch" href="/jest-tutorial/assets/js/19.0c05163f.js"><link rel="prefetch" href="/jest-tutorial/assets/js/20.55eba354.js"><link rel="prefetch" href="/jest-tutorial/assets/js/21.5edf9c70.js"><link rel="prefetch" href="/jest-tutorial/assets/js/22.77f22525.js"><link rel="prefetch" href="/jest-tutorial/assets/js/23.3e072b91.js"><link rel="prefetch" href="/jest-tutorial/assets/js/24.d8220887.js"><link rel="prefetch" href="/jest-tutorial/assets/js/25.1c35c041.js"><link rel="prefetch" href="/jest-tutorial/assets/js/26.d4b69710.js"><link rel="prefetch" href="/jest-tutorial/assets/js/4.2d7ecec7.js"><link rel="prefetch" href="/jest-tutorial/assets/js/5.b1a8dea6.js"><link rel="prefetch" href="/jest-tutorial/assets/js/6.ee81796b.js"><link rel="prefetch" href="/jest-tutorial/assets/js/7.45845233.js"><link rel="prefetch" href="/jest-tutorial/assets/js/8.8fda6116.js"><link rel="prefetch" href="/jest-tutorial/assets/js/9.89aee88f.js">
    <link rel="stylesheet" href="/jest-tutorial/assets/css/0.styles.3af8d58b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/jest-tutorial/" class="home-link router-link-active"><img src="/jest-tutorial/images/logo.png" alt="Jest 实践指南" class="logo"> <span class="site-name can-hide">Jest 实践指南</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/haixiangyan/jest-tutorial/issues" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/haixiangyan/jest-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/haixiangyan/jest-tutorial/issues" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/haixiangyan/jest-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jest-tutorial/" aria-current="page" class="sidebar-link">小书介绍</a></li><li><a href="/jest-tutorial/intro/why-test/" class="sidebar-link">为什么要测试</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jest-tutorial/basic/getting-started/" class="sidebar-link">起步</a></li><li><a href="/jest-tutorial/basic/transformer/" class="sidebar-link">转译器</a></li><li><a href="/jest-tutorial/basic/test-environment/" class="sidebar-link">测试环境</a></li><li><a href="/jest-tutorial/basic/navigation/" class="sidebar-link">Mock 网页地址</a></li><li><a href="/jest-tutorial/basic/tdd/" class="sidebar-link">测试驱动开发</a></li><li><a href="/jest-tutorial/basic/mock-timer/" class="sidebar-link">Mock Timer</a></li><li><a href="/jest-tutorial/basic/config-react/" class="sidebar-link">引入 React（纯配置）</a></li><li><a href="/jest-tutorial/basic/snapshot-test/" class="sidebar-link">快照测试</a></li><li><a href="/jest-tutorial/basic/component-test/" class="sidebar-link">组件测试</a></li><li><a href="/jest-tutorial/basic/how-to-mock/" class="sidebar-link">Mock 大全</a></li><li><a href="/jest-tutorial/basic/redux-test/" class="sidebar-link">Redux 测试</a></li><li><a href="/jest-tutorial/basic/hook-test/" class="sidebar-link">React Hook 测试</a></li><li><a href="/jest-tutorial/basic/static-tool/" class="sidebar-link">静态检查工具</a></li><li><a href="/jest-tutorial/basic/performance/" aria-current="page" class="active sidebar-link">Jest 性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jest-tutorial/basic/performance/#jest-架构" class="sidebar-link">Jest 架构</a></li><li class="sidebar-sub-header"><a href="/jest-tutorial/basic/performance/#虚拟文件系统" class="sidebar-link">虚拟文件系统</a></li><li class="sidebar-sub-header"><a href="/jest-tutorial/basic/performance/#多线程" class="sidebar-link">多线程</a></li><li class="sidebar-sub-header"><a href="/jest-tutorial/basic/performance/#文件转译" class="sidebar-link">文件转译</a></li><li class="sidebar-sub-header"><a href="/jest-tutorial/basic/performance/#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/jest-tutorial/basic/automation/" class="sidebar-link">自动化测试</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>测试思路</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jest-tutorial/thoughts/articles.html" class="sidebar-link">所有文章</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>最后</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jest-tutorial/end/github.html" class="sidebar-link">Github 项目</a></li><li><a href="/jest-tutorial/end/end.html" class="sidebar-link">结语</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jest-性能优化"><a href="#jest-性能优化" class="header-anchor">#</a> Jest 性能优化</h1> <p>非常感谢能看到最后，这本指南也快到尾声了。</p> <p>你应该也积累了不少测试文件，会发现跑这十几个测试用例变得越来越慢了，动辄一两分钟。理论上，单测和集成测试不应该跑这么慢的。所以，这一章来聊聊 <strong>Jest 的性能优化</strong>。</p> <h2 id="jest-架构"><a href="#jest-架构" class="header-anchor">#</a> Jest 架构</h2> <p>要解决 Jest 的性能问题，我们得了解一下 Jest 是怎么运行的。之前偶然在 <a href="https://www.youtube.com/watch?v=3YDiloj8_d0&amp;t=2s" target="_blank" rel="noopener noreferrer">YouTube<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 上看到 Jest 作者非常详细地讲述整个 Jest 执行流程，在这里我只做了一下简单地搬运。英语比较好的同学可以直接看视频进行了解。</p> <p><img src="/jest-tutorial/assets/img/jest-architecture.82649a92.png" alt=""></p> <p>从上图可以看到，最影响 Jest 性能的有 3 个地方：</p> <ol><li><strong>使用 <code>jest-haste-map</code> 生成虚拟文件系统</strong></li> <li><strong>多线程执行测试任务</strong></li> <li><strong>转译 JavaScript 代码</strong></li></ol> <h2 id="虚拟文件系统"><a href="#虚拟文件系统" class="header-anchor">#</a> 虚拟文件系统</h2> <p>如果要在热更新时修改文件，脚手架都要遍历一次项目文件，非常损耗性能。特别在一些文件特别多的巨石应用中，电脑分分钟就卡得动不了。</p> <p>为了解决这个问题，Facebook 团队就想到了一个方法 —— <strong>虚拟文件系统</strong>。原理很简单：<strong>在第一次启动时遍历整个项目，把文件存储成 Map 的形式，
之后文件做了改动，那么只需增量地修改这个 Map 就可以了。</strong> 他们把这个工具命名为 <strong>Haste Map</strong>，中文翻译可以理解为快速生成 Map 的东西（这名字真的不好）。</p> <p><strong>这种思路不仅可以用于热更新场景，还能应用在所有监听文件改动的场景，其中一种就是 <code>npx jest --watch</code> 这个场景。</strong></p> <p><img src="/jest-tutorial/assets/img/haste-map.0cd61a1b.png" alt=""></p> <p>因此，上面图中刚开始时，Jest 就用 <code>jest-haste-map</code> 生成了一次虚拟文件系统，这样后续的过滤、搜索文件就非常快速了。这也是为什么执行第一个测试用例时速度比较慢的原因。
这一步的性能我们无法优化。</p> <h2 id="多线程"><a href="#多线程" class="header-anchor">#</a> 多线程</h2> <p>Jest 还有一个非常强大的功能，利用 Node.js 的 Worker 开启多个线程来执行测试用例。对于一些大型项目（几千个测试用例）来说，这能提升不少效率。</p> <p>但线程不是越多越好，每开一个线程都需要额外的开销。如果不做任何配置，那么 Jest 默认最大的 Worker 数是 <code>CPU 数 - 1</code>。其中的 <code>1</code> 用于运行 <code>jest-cli</code>，
剩下的都拿来执行测试用例。由于之前我们一直没有对 <code>maxWorkers</code> 进行配置，所以默认会用最多的 Worker，执行这么几十个简单的测试会非常慢。</p> <p>通常来说，单个测试用例速度应该要做到非常快的，尽量不写一些耗时的操作，比如不要加 <code>setTimeout</code>，<code>n</code> 个 <code>for</code> 循环等。
所以，理论上，测试数量不多的情况下单线程就足够了。这里我们可以把 <code>jest.config.js</code> 配置改为用单线程：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// jest.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">maxWorkers</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在流水线中，Jest 也推荐使用单线程来跑单测和集成测试：<code>jest --runInBand</code>，其中 <code>runInBand</code> 和 <code>maxWorkers: 1</code> 效果是一样的。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><strong>我试了一下在以前的 Intel Mac 里单线程的速度比多线程快了一倍，而 M1 的 Mac 上则是相反，多线程比单线程快。所以，还是要自己的机器的情况来决定使用多少个 Worker。</strong></p></div> <p><strong>M1 Macbook Pro，单线程：</strong></p> <p><img src="/jest-tutorial/assets/img/single-worker.5024c896.png" alt="1 个 Worker"></p> <p><strong>M1 Macbook Pro，多线程：</strong></p> <p><img src="/jest-tutorial/assets/img/multiple-workers.497a34f8.png" alt="默认 maxWorkers"></p> <h2 id="文件转译"><a href="#文件转译" class="header-anchor">#</a> 文件转译</h2> <p>最后一个性能优化点就是转译速度（图中第 11 步）。需要注意的是 Jest 是会边执行测试用例边转译 JavaScript。</p> <p><img src="/jest-tutorial/assets/img/transpile.56f11504.png" alt=""></p> <p>有的同学会问了：既然 Jest 刚开始遍历项目来生成虚拟文件系统，为什么不顺便把转译的工作做了呢？<strong>当然是因为慢了。</strong>
首先，对于很多业务项目来说，测试并不会很多。可能就测几个 <code>utils</code> 下的函数，那如果把项目的文件都转译一次，会把很多没用到测试的业务代码也转译。</p> <p>这些同学还不甘心：那可以在拿到测试文件后，分析出这个文件的依赖，再来做转译（在第 7，8 步）了，然后再执行测试呀？理论上是可以的。但是，
<strong>JavaScript 引入模块的方式实在是太多了</strong>，先不说 <code>amd</code>, <code>es6</code>, <code>umd</code>, <code>cmd</code>, <code>abcd</code> 这么多的引入方式了，单单这个就很难处理：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// ├── index.ts</span>
<span class="token comment">// └── instances</span>
<span class="token comment">//     ├── api1.ts</span>
<span class="token comment">//     ├── api2.ts</span>
<span class="token comment">//     ├── api3.ts</span>
<span class="token comment">//     └── api4.ts</span>

<span class="token comment">// index.ts</span>
<span class="token keyword">const</span> services <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">require</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'./instances'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>services<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// api1, api2, api3, api4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>所以说，通过文件找依赖的方式不是很可靠，有太多不确定因素，最终 Jest 还是选择 “执行到那个文件再做转译” 的方法。</strong></p> <p>原理说完了，下面来看看怎么提高转译效率。在前面的章节里，我们说到当今 JavaScript 的转译器有很多种，不仅可以用 <code>tsc</code> 和 <code>babel</code> 来转，
还能用别的语言写的转译器 <code>swc</code> 以及 <code>esbuild</code> 来转。</p> <p>如果想用 <code>esbuild</code> 做转译，可以看 <a href="https://github.com/aelbore/esbuild-jest" target="_blank" rel="noopener noreferrer">esbuild-jest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这个库。这里我用 <a href="https://swc.rs/docs/usage/jest" target="_blank" rel="noopener noreferrer">@swc/jest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 做例子，
先安装依赖：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> i -D @swc/core@1.2.165 @swc/jest@0.2.20
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后在 <code>jest.config.js</code> 里添加：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 不用 ts-jest</span>
  <span class="token comment">// preset: &quot;ts-jest&quot;, </span>

  <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用 swc 转译 JavaScript 和 TypeScrit</span>
    <span class="token string-property property">&quot;^.+\\.(t|j)sx?$&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@swc/jest&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 静态资源 stub 转译</span>
    <span class="token string-property property">&quot;.+\\.(css|styl|less|sass|scss|png|jpg|ttf|woff|woff2)$&quot;</span><span class="token operator">:</span>
      <span class="token string">&quot;jest-transform-stub&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>大功告成，配置非常简单，我们来看看使用 <code>ts-jest</code> 以及 <code>@swc/jest</code> 两者的对比。</p> <p><strong>ts-jest：</strong></p> <p><img src="/jest-tutorial/assets/img/ts-jest.4c97d98e.png" alt="ts-jest"></p> <p><strong>@swc/jest：</strong></p> <p><img src="/jest-tutorial/assets/img/swc.8c4aebf1.png" alt="@swc/jest"></p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>这一章我们学到了 Jest 的整体架构，其中有 3 个地方比较耗性能：</p> <ol><li><strong>生成虚拟文件系统。</strong> 在执行第一个测试会很慢</li> <li><strong>多线程。</strong> 生成新线程耗费的资源，不过，不同机器的效果会不一致</li> <li><strong>文件转译。</strong> Jest 会在执行到该文件再对它进行转译</li></ol> <p>解决的方法有：</p> <ol><li>无解，有条件的话拆解项目吧</li> <li>具体情况具体分析，要看机器的执行情况，多线程快就用多线程，单线程快就用单线程</li> <li>使用 <code>esbuild-jest</code>、 <code>@swc/jest</code> 等其它高效的转译工具来做转译</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">5/23/2022, 10:10:42 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/jest-tutorial/basic/static-tool/" class="prev">
        静态检查工具
      </a></span> <span class="next"><a href="/jest-tutorial/basic/automation/">
        自动化测试
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/jest-tutorial/assets/js/app.dfa51a05.js" defer></script><script src="/jest-tutorial/assets/js/2.03a6ea53.js" defer></script><script src="/jest-tutorial/assets/js/3.9fccf44d.js" defer></script>
  </body>
</html>
